
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>大模型显存估算器（修正版GraphRAG）</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h2 { color: #2c3e50; }
        label { display: block; margin-top: 10px; }
        input { padding: 5px; margin-top: 5px; width: 200px; }
        table { margin-top: 20px; border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        #result { margin-top: 20px; }
    </style>
</head>
<body>
    <h2>大模型显存估算器（多精度 + GraphRAG 修正）</h2>
    <label for="modelSize">模型规模（单位：Billion 参数量，例如32）:</label>
    <input type="number" id="modelSize" placeholder="例如：32" step="1">
    <button onclick="calculate()">计算显存</button>

    <div id="result"></div>

    <script>
        function calculate() {
            const modelSize = parseFloat(document.getElementById("modelSize").value);
            if (isNaN(modelSize)) {
                document.getElementById("result").innerText = "请输入模型规模（单位：Billion）";
                return;
            }

            const precisions = {
                "FP32": 4,
                "FP16/BF16": 2,
                "INT8": 1,
                "INT4": 0.5
            };

            let html = `<table>
                <tr>
                    <th>精度</th>
                    <th>推理显存 (GB)</th>
                    <th>LoRA 微调显存 (GB)</th>
                    <th>GraphRAG 显存 (GB)</th>
                </tr>`;

            for (let key in precisions) {
                const bytesPerParam = precisions[key];

                // 权重显存
                const weightMemory = modelSize * 1e9 * bytesPerParam / (1024 ** 3);

                // 通用激活/通信开销
                const activationMemory = 5;
                const overheadMemory = 5;

                // 推理总显存
                const inferenceTotal = weightMemory + activationMemory + overheadMemory;

                // LoRA 相关：参数 + 梯度 + 优化器状态（3x）
                const loraParamRatio = 0.015;
                const loraParamMemory = modelSize * 1e9 * loraParamRatio * 2 / (1024 ** 3);
                const loraGradOptMemory = loraParamMemory * 3;
                const loraTotal = inferenceTotal + loraParamMemory + loraGradOptMemory;

                // GraphRAG 显存 = 推理 + 2.0GB（用于 bge-m3 向量模型）
                const graphragTotal = inferenceTotal + 2.0;

                html += `<tr>
                    <td>${key}</td>
                    <td>${inferenceTotal.toFixed(2)}</td>
                    <td>${loraTotal.toFixed(2)}</td>
                    <td>${graphragTotal.toFixed(2)}</td>
                </tr>`;
            }

            html += "</table>";
            document.getElementById("result").innerHTML = html;
        }
    </script>
</body>
</html>
